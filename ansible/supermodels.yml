- hosts: localhost
  environment:
    PETSC_DIR: /opt/app/petsc
    PETSC_ARCH: arch-linux2-c-debug
    LD_LIBRARY_PATH: "/opt/app/lib"
    PYTHONPATH: "/opt/app/PyTOUGH:/opt/app/credo2:/opt/app/supermodels-test/utils"
    PATH: "{{ ansible_env.PATH }}:/opt/app/bin:/opt/app/supermodels-test/dist"

  tasks:
  - name: Clean supermodels-test path
    file:
      state: absent
      path: /opt/app/supermodels-test

  - name: Fetch supermodels-test from github
    git:
      repo: 'https://jposunz:wapiti21@github.com/johnburnell/supermodels-test.git'
      dest: /opt/app/supermodels-test
      version: testing

  - name: replace HOME with app directory
    replace:
      dest: /opt/app/supermodels-test/makefile
      regexp: '\$\(HOME\)'
      replace: '/opt/app'

  - name: echo path
    shell: echo $PATH


  - name: Make the supermodels-test
    shell: make
    args:
      chdir: /opt/app/supermodels-test

  - name: Execute supermodels unit_tests
    shell: python unit_tests.py
    args:
      chdir: /opt/app/supermodels-test
